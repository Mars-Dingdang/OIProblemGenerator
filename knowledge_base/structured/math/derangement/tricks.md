## 关键观察
1. **容斥公式**: $D_n = n! \sum_{k=0}^{n} \frac{(-1)^k}{k!}$，可以直接计算。
2. **递推关系**: $D_0 = 1, D_1 = 0$，对于 $n \ge 2$，$D_n = (n-1)(D_{n-1} + D_{n-2})$。
3. **近似值**: 当 $n$ 较大时，$D_n \approx \frac{n!}{e}$，其中 $e$ 是自然常数。

## 优化技巧
- 使用递推式可以在 $O(n)$ 时间内预处理所有 $D_n$，查询 $O(1)$。
- 对于模素数 $p$，可以使用逆元计算阶乘和逆阶乘，然后应用容斥公式。
- 注意 $D_n$ 可能很大，通常需要取模。

## 常见问题转换
1. **信封问题**: $n$ 封信放入 $n$ 个信封，每个信封不能放对应编号的信，即错位排列。
2. **夫妻问题**: $n$ 对夫妻围坐圆桌，每对夫妻不相邻，可转化为错位排列变体。
3. **部分错位排列**: 允许某些位置固定，使用容斥原理计算。
4. **概率应用**: 随机排列中无固定点的概率趋近于 $1/e$。

## 扩展
- **带限制的错位排列**: 某些位置必须错位，某些可以固定，使用容斥或递推。
- **错位排列生成**: 可以生成所有错位排列，但数量增长很快。
- **错位排列与排列循环**: 错位排列是没有任何长度为 1 的循环的排列。