## Key Observations
- **Wilson 定理**: 对于素数 p，(p-1)! ≡ -1 (mod p)。
- **Gauss 推广**: 对于模 m，所有与 m 互素的数的乘积 ≡ ±1 (mod m)，取 -1 当且仅当 m=2,4,p^α,2p^α（p 奇素数）。
- **递归分解**: (n!)_p ≡ (-1)^{⌊n/p⌋} · (n mod p)! · (⌊n/p⌋!)_p (mod p)。对于素数幂模，将 -1 替换为 ±1 并调整预处理。
- **Legendre 公式**: ν_p(n!) = ∑_{i≥1} ⌊n/p^i⌋ = (n - S_p(n))/(p-1)，其中 S_p(n) 是 p 进制下各位和。
- **Kummer 定理**: ν_p(C(m,n)) 等于 p 进制下 m 减 n 的借位次数，即 (S_p(n) + S_p(m-n) - S_p(m))/(p-1)。

## Optimizations
- **预处理**: 对于素数模，预计算 0! 到 (p-1)! mod p；对于素数幂模，预计算所有与 p 互素的数的累积乘积 mod p^α。
- **空间优化**: 若内存紧张，可只计算递归中实际用到的阶乘值并排序后批量计算。
- **迭代实现**: 递归是尾递归，可转为迭代，避免栈开销。

## Problem Transformations
- **组合数取模**: 利用分解 n! = p^{ν_p(n!)} (n!)_p，分子分母中 p 的幂次相消，互素部分用逆元计算。
- **中国剩余定理**: 将合数模分解为素数幂模，分别计算后合并。
- **素数判定**: 利用 Wilson 定理，但 O(n) 计算阶乘不实用，可用于理论推导（如例题 HDU 2973）。