# 浅谈多项式牛顿迭代与拉格朗日反演在OI 中的应用

**Author:** 左骏驰

### 关键思想与技巧

#### 多项式牛顿迭代
- **核心公式**：若已知 $ F(A(x)) \equiv 0 \pmod{x^m} $，欲求 $ B(x) $ 满足 $ F(B(x)) \equiv 0 \pmod{x^{2m}} $，利用泰勒展开忽略高阶项得：
  $$
  B(x) = A(x) - \frac{F(A(x))}{F'(A(x))}
  $$
  此方法倍增精度，共进行 $ O(\log n) $ 轮迭代。
- **适用条件**：$ F(G(x)) $ 易于计算（如低次多项式或可用 exp/ln 表示）。当 $ F $ 是关于 $ G(x), x $ 的二元函数时，对 $ G(x) $ 求偏导即可推广使用。
- **高级应用**：
  - 含有 $ G(x^2), G(x^3) $ 等项的方程中，由于 $ G(x^k) $ 在模 $ x^{2m} $ 下由 $ G(x) \mod x^m $ 完全确定，可在迭代中视为常数处理。
  - 解微分方程 $ G'(x) = F(G(x), x) $：将 $ F(G(x), x) $ 在 $ G(x) = A(x) $ 处泰勒展开，转化为线性微分方程，再通过积分因子法求解。

#### 拉格朗日反演
- **基本形式**：若 $ G(x) $ 是 $ F(x) $ 的复合逆（即 $ F(G(x)) = x $），则
  $$
  [x^n]G(x) = \frac{1}{n}[x^{-1}]\left(\frac{1}{F(x)}\right)^n
  $$
- **推广形式**：对任意函数 $ H $，
  $$
  [x^n]H(G(x)) = \frac{1}{n}[x^{-1}]H'(x)\left(\frac{1}{F(x)}\right)^n,\quad n \geq 1
  $$
- **证明思路**：由 $ H(G(x)) = \sum a_i x^i $ 推出 $ \sum a_i F(x)^i = H(x) $，两边求导后除以 $ F(x)^n $，提取 $ x^{-1} $ 项系数即得结论。
- **应用场景**：
  - 计算树、连通图、点双/边双连通图的数量（如 Cayley 公式推导 $ n^{n-2} $）。
  - 将形如 $ [x^k]F(x)G(x)^i $ 的求和问题引入辅助变量 $ u $，构造生成函数 $ \frac{F(x)}{1 - uG(x)} $，再用拉格朗日反演统一处理。

#### 复合逆的存在性与唯一性
- 对于满足 $ [x^0]F(x)=0, [x^1]F(x) \ne 0 $ 的生成函数 $ F(x) $，其左逆与右逆均存在且相等，可通过递推构造系数完成证明。

#### 多项式复合与复合逆算法
- **大步小步法（Baby-step Giant-step）**：
  - 预处理 $ G(x)^0, G(x)^1, ..., G(x)^B $ 和 $ G(x)^B, G(x)^{2B}, ..., G(x)^{B^2} $，其中 $ B = \lceil \sqrt{n} \rceil $。
  - 利用分解 $ F(G(x)) = \sum_{i=0}^{B-1} G(x)^{iB} \sum_{j=0}^{B-1} [x^{iB+j}]F(x) G(x)^j $ 实现快速计算。
  - 时间复杂度 $ O(n^{1.5} \log n + n^2) $，实践中可通过调整块大小优化。
- **Brent-Kung 算法**：
  - 将 $ G(x) = G_1(x) + G_2(x) $，其中 $ G_1(x) $ 被 $ x^m $ 整除（$ m = \Theta(\sqrt{n / \log n}) $）。
  - 在 $ G_2(x) $ 处泰勒展开 $ F(G(x)) $，仅前 $ \lceil n/m \rceil $ 项有贡献。
  - 使用分治 NTT 计算 $ F^{(k)}(G_2(x)) $，然后做卷积合并结果。
  - 总复杂度 $ O((n \log n)^{1.5}) $，理论更优但常数较大。
- **复合逆的求解**：
  - 将问题转化为求解方程 $ F(G(x)) - x = 0 $，使用牛顿迭代法：
    $$
    G_{\text{new}}(x) = G_{\text{old}}(x) - \frac{F(G_{\text{old}}(x)) - x}{F'(G_{\text{old}}(x))}
    $$
  - 若使用 Brent-Kung 进行复合运算，则总时间复杂度仍为 $ O((n \log n)^{1.5}) $。

#### 实际优化与变形技巧
- 当 $ G(x) $ 常数项非零或最低次项非一次时，需先进行平移或提取幂次处理（如令 $ G(x) = c + Q(x) $ 或 $ G(x) = g_t x^t Q(x)^t $），再转化为标准形式求解。
- 分治 NTT 可用于合并多个子问题的结果（如抽卡问题中连续段划分）。