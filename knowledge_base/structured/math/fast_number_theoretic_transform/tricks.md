## 关键观察与技巧

1.  **模数选择**：NTT 要求模数 $p$ 满足 $p = k \cdot 2^m + 1$，且 $2^m$ 大于等于变换长度。常用模数：
    -   998244353 = 7 × 17 × 2^23 + 1, 原根 g = 3
    -   1004535809 = 479 × 2^21 + 1, 原根 g = 3
    -   469762049 = 7 × 2^26 + 1, 原根 g = 3

2.  **长度对齐**：进行 NTT 前，必须将多项式长度补足到 2 的幂，以满足分治要求。

3.  **逆变换**：逆变换 (opt = -1) 后，需要乘上长度 $n$ 的逆元，并反转除首项外的系数。

4.  **卷积与循环卷积**：默认 NTT 计算的是线性卷积。若长度 $n$ 不足，结果会是循环卷积（模 $x^n - 1$）。

5.  **任意模数卷积 (MTT)**：当模数不满足 NTT 条件或需要任意模数时，常用技巧：
    -   **三模数 NTT**：用三个满足条件的模数分别做 NTT，再用中国剩余定理 (CRT) 合并。
    -   **拆系数 FFT**：将系数拆成高位和低位，分别做 FFT 以减少精度误差。

6.  **预处理单位根**：可以预先计算所有需要的单位根幂次，避免重复快速幂，常数优化显著。

7.  **位逆序置换**：可以通过递推公式 `rev[i] = (rev[i >> 1] >> 1) | ((i & 1) ? n >> 1 : 0)` 高效生成。

8.  **应用模式**：
    -   **多项式乘法**：直接卷积。
    -   **大数乘法**：将数字视为多项式系数（基数为 10 或其他进制），卷积后处理进位。
    -   **字符串匹配**：将字符转化为系数，利用卷积计算匹配函数。
    -   **集合卷积**：子集卷积需结合占位多项式（FWT 或 FMT）。

9.  **优化技巧**：
    -   使用迭代而非递归实现，减少函数调用开销。
    -   在循环内联乘法、取模操作。
    -   对于固定长度的变换，可以硬编码单位根表。