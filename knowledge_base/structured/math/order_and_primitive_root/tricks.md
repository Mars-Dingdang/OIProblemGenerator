## 关键观察与技巧

### 阶的性质
1. **阶整除欧拉函数**: 若 `gcd(a, m) = 1`，则 `ord_m(a) | φ(m)`。
2. **幂的阶**: `ord_m(a^k) = ord_m(a) / gcd(ord_m(a), k)`。
3. **乘积的阶**: 若 `gcd(ord_m(a), ord_m(b)) = 1`，则 `ord_m(ab) = ord_m(a) * ord_m(b)`。一般地，`lcm(ord_m(a), ord_m(b)) / gcd(ord_m(a), ord_m(b)) | ord_m(ab) | lcm(ord_m(a), ord_m(b))`。
4. **存在性**: 对于任意 `a, b`，总存在 `c` 使得 `ord_m(c) = lcm(ord_m(a), ord_m(b))`。

### 原根判定与寻找
1. **判定定理**: `g` 是模 `m` 的原根当且仅当对于 `φ(m)` 的每个质因子 `p`，有 `g^(φ(m)/p) ≠ 1 (mod m)`。
2. **原根存在条件**: `m = 1, 2, 4, p^e, 2p^e`，其中 `p` 为奇素数，`e ≥ 1`。
3. **原根数量**: 若原根存在，则恰有 `φ(φ(m))` 个原根。
4. **寻找策略**:
   - **暴力枚举**: 从小到大枚举 `g`，利用判定定理验证。最小原根上界约为 `O(p^0.25+ε)`。
   - **随机化**: 随机选取 `g` 并验证，期望尝试次数约为 `O(log log m)`。
5. **优化**: 需要预先计算 `φ(m)` 及其质因数分解。分解是复杂度瓶颈（如 Pollard Rho）。

### Carmichael 函数
1. **定义**: `λ(m) = lcm{ ord_m(a) | gcd(a, m)=1 }`，即所有与 `m` 互素元素的阶的最小公倍数。
2. **递推公式**:
   - `λ(1)=1, λ(2)=1, λ(4)=2`
   - 对于 `m=2^e (e≥3)`, `λ(m)=2^(e-2)`
   - 对于奇素数幂 `p^e`, `λ(m)=p^(e-1)*(p-1)`
   - 对于互素的 `m1, m2`, `λ(m1*m2)=lcm(λ(m1), λ(m2))`
3. **与原根关系**: 原根存在 ⇔ `λ(m) = φ(m)`。
4. **应用**: Carmichael 数是满足 `λ(n) | n-1` 的合数，是 Fermat 素性测试的伪素数。

### 模 2^e 的特殊结构
- 当 `e ≥ 3` 时，模 `2^e` 的既约剩余系可表示为 `{ ±5^k mod 2^e | 0 ≤ k < 2^(e-2) }`。
- 5 模 `2^e` 的阶为 `2^(e-2)`。

### 问题转化模式
1. **离散对数**: 若 `g` 是原根，则 `a ≡ g^x (mod m)` 可转化为离散对数问题。
2. **构造特定阶元素**: 利用阶的性质 3 和 5，通过已知阶的元素构造目标阶元素。
3. **幂的循环节**: 计算 `a^n mod m` 时，可将 `n` 对 `ord_m(a)` 取模，简化计算。

### 竞赛注意事项
- 原根判定需要 `φ(m)` 的质因数分解，务必预处理或高效分解。
- 对于大质数 `p`，最小原根通常很小（平均约 4.9），暴力枚举很快。
- 若模数无原根，可考虑使用 Carmichael 函数分析最大阶。
- 模 `2^e` 的情形需单独处理，利用 `±5^k` 结构可简化运算。