# 浅谈DFT在信息学竞赛中的应用

**Author:** 刘承奥

### 关键思想与技巧

- **抽象建模**：将序列视为从定义域 G（如集合、群、半群）到值域 R（如环、域）的映射 f: G → R，统一处理各种卷积（加法卷积、异或卷积、子集卷积等）。

- **卷积性变换定义**：若存在线性同构 F: R^G_* → R^G_· 满足 F(a ∗ b) = F(a) · F(b)，则称 F 为卷积性变换。这使得卷积可在变换后通过点积高效计算。

- **经典 DFT 条件**：当 R 是无零因子环，且包含 n 次本原单位根 ω_n 和 n 的乘法逆元时，DFT 可定义为：
  
  $$
  F(f)(x) = \sum_{i \in \mathbb{Z}_n} \omega_n^{ix} f(i),\quad
  F^{-1}(f)(x) = \frac{1}{n} \sum_{i \in \mathbb{Z}_n} \omega_n^{-ix} f(i)
  $$

  此时 DFT 是卷积到点积的同构。典型例子包括复数域上的 FFT 和模素数 p（n | p−1）下的 NTT。

- **复合变换原理**：若 F 和 F' 分别是 R^G 和 R^{G'} 上的卷积性变换，则其复合 F' ◦ F 是 R^{G⊗G'} 上的卷积性变换，对应高维 DFT 或多变量情况。

- **集合幂级数**：当下标 G 是幂集 2^U 时，若运算是按位独立的（如异或、交、并），可分解为每个元素的一维变换再复合。例如，异或卷积对应 Z₂ 上的 DFT，即 FWT；子集卷积可通过 Möbius 变换实现。

- **有限交换半群上的 DFT 存在条件**：
  - G 必须满足**循环性**：∀i ∈ G, ∃j > 0 使得 i^{j+1} = i。
  - 利用幂等元 i⁰ = i^{ord(i)} 将 G 划分为等价类 C_x = {i | i⁰ = x}，这些等价类构成一个**半格 GC**（所有元素幂等）。
  - 在每个循环子群 C_x 上使用有限交换群基本定理分解为质数幂阶循环群直和，然后在其上应用经典 DFT。
  - 非零解仅出现在某个 S_C = {D ∈ GC | D ◦ C = C} 中，其余设为 0，保证方程组 xi◦j = xi·xj 成立。
  - 构造的变换矩阵 T 是分块上三角形式，每一块是对应等价类的 DFT 矩阵，整体可逆。

- **算法实现要点**：
  - 先对 G 按幂等元分类，拓扑排序 GC（按半格结构）。
  - 对每个等价类 C_x，求其作为有限交换群的基（最大阶贪心法），逐维构造 DFT 矩阵。
  - 合并所有解形成总变换矩阵 T，最后通过分块高斯消元归一化得到逆变换 T⁻¹。

- **一般卷积优化模型**：即使无法构造完整 DFT，也可尝试用组合优化方式设计两步线性变换 + 中间卷积的方案，使总代价低于朴素 O(|G|²)。例如允许部分修改运算表，用少量大 DFT + 多个小 DFT（分治）混合策略，达到次二次复杂度。