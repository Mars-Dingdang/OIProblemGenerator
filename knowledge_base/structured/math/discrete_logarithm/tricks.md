## 关键观察与技巧

1. **BSGS 核心思想**：将指数 x 表示为 x = A·⌈√m⌉ - B，其中 0 ≤ A, B ≤ ⌈√m⌉，将原方程转化为 a^{A·⌈√m⌉} ≡ b·a^B (mod m)，通过预计算右边所有可能的 b·a^B 值（baby steps），再枚举左边（giant steps）寻找匹配。

2. **互质要求**：标准 BSGS 要求 a 与 m 互质，否则 a^B 可能没有逆元，无法从 a^{A·⌈√m⌉} ≡ b·a^B 推导回 a^{A·⌈√m⌉ - B} ≡ b。

3. **扩展 BSGS (exBSGS)**：当 a 与 m 不互质时，通过不断提取 gcd(a, m) 直到互质：
   - 设 d = gcd(a, m)，若 d ∤ b 则无解。
   - 否则方程两边除以 d，得到 (a/d)·a^{x-1} ≡ b/d (mod m/d)。
   - 重复此过程直到 a 与模数互质，记总共除了 k 次，得到 a^k/D · a^{x-k} ≡ b/D (mod m/D)，其中 D = ∏d_i。
   - 此时 a^k/D 与模数互质，可移到右边，转化为标准 BSGS 求解 x-k，最后加上 k。
   - 注意：需先枚举 i = 0..k 检查 a^i ≡ b (mod m) 是否成立，避免解 ≤ k 的情况被忽略。

4. **实现细节**：
   - 使用哈希表（如 unordered_map）存储 baby steps 以获得 O(√m) 平均时间复杂度，但最坏情况可能退化；使用 map 则为 O(√m log m)。
   - 注意取模运算中的负数处理，确保所有值在 [0, m-1] 范围内。
   - 当 m 为 1 或 b ≡ 1 (mod m) 时，直接返回 0。

5. **原根与离散对数性质**：
   - ind_g(ab) ≡ ind_g(a) + ind_g(b) (mod φ(m))
   - ind_g(a^n) ≡ n·ind_g(a) (mod φ(m))
   - 换底公式：ind_g(a) ≡ ind_{g1}(a)·ind_g(g1) (mod φ(m))
   - 这些性质可用于简化问题或进行变换。

6. **模数为素数**：若 m 为素数，则 φ(m) = m-1，且原根存在。此时离散对数问题可直接应用 BSGS，且可能结合费马小定理等进一步优化。

7. **无解判断**：在 exBSGS 中，若某一步 gcd(a, m) 不整除 b，则方程无解。

8. **数值范围**：注意 a, b, m 可能很大（如 10^9 以上），使用 long long 并避免乘法溢出（可用 __int128 或快速乘）。

9. **习题模式**：常见题型包括直接求解离散对数、结合原根求指数、在密码学场景中应用等。模板题如 SPOJ MOD、Luogu4195 等。