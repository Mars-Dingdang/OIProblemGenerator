# 浅谈线性基在 OI 中的应用

**Author:** 陈昕阳

### 关键思想与技巧

#### **1. 线性基的本质与等价序列**
- 线性基的核心思想是将原序列 $ S $ 转化为一个等价序列 $ T $，使得两者所有子序列的异或和构成的集合相同。
- 通过增量构造法，每次将新元素从高位向低位尝试插入，若某位已有基元素，则用其异或消去该位，最终得到一组最高位严格递减的基。
- 定理：从序列中任选两个元素 $ a_i, a_j $，将 $ a_j $ 替换为 $ a_i \oplus a_j $，新序列与原序列等价（子序列异或和集合不变）。

#### **2. 基础应用**
- **最大异或和**：从高到低遍历每一位，若当前答案异或上该位基能变大，则更新答案。时间复杂度 $ O(m) $。
- **判断异或和是否存在**：尝试将目标值插入线性基，若失败则存在；否则不存在。
- **异或和小于定值的个数**：按位数位DP思想，利用线性基的单调性进行剪枝，逐位决策是否选择该基元素，时间复杂度 $ O(m) $。
- **图上路径最大异或和**：利用生成树提取回路权值，所有简单回路的异或和张成的空间即为可调整部分，任取一条 $ 1 \to n $ 路径的异或和，再异或上线性基的最大组合即可得解。

#### **3. 优化技巧**
- **线性基合并**：将两个线性基视为序列拼接后重构，时间复杂度 $ O(m^2) $，满足结合律，可用于线段树维护区间线性基。
- **前缀线性基（贪心优先级）**：
  - 给每个元素赋予优先级（如插入顺序），在插入时保证高优先级元素占据高位。
  - 实现方式：插入时若当前位有基且其优先级更低，则交换二者，并继续向下消元。
  - 应用：支持离线处理删除（以删除时间为优先级）、区间查询（保留优先级在范围内的基）。
- **维护等价序列**：通过差分或变换简化修改操作的影响。例如对序列做区间异或，可转化为差分数组的单点修改，从而降低维护难度。
- **进一步消元（对角化）**：
  - 在基础线性基上，升序遍历每一位，用 $ w_i $ 消去所有更高位 $ w_j (j > i) $ 中的第 $ i $ 位。
  - 结果：每个 $ w_i $ 是唯一包含其最高位的元素，实现“标准型”。
  - 用途：用于快速计算最小异或和方案，进而推导最大异或和，优化某些复杂查询的常数与逻辑。

#### **4. 正交线性基与FWT视角**
- **FWT变换性质**：序列异或卷积的FWT等于FWT后的逐点乘积；两次FWT后结果为原序列乘 $ 2^m $。
- **点值序列的正交表示**：
  - 设 $ v(S)_k $ 表示异或和为 $ k $ 的子序列个数。
  - 其FWT结果 $ \hat{v}(S)_k = 2^{|S|} $ 当且仅当 $ k $ 与 $ S $ 中所有元素正交（即 $ k \odot x = 0, \forall x \in S $），否则为0。
- **正交线性基构造**：
  - 对原线性基进行进一步消元后，对于每个空缺位 $ i $（$ w_i = 0 $），构造一个向量 $ w'_i $，使其在该位为1，并根据其他基向量的依赖关系填充高位，确保其与所有原基正交。
  - 所有这样的 $ w'_i $ 构成正交线性基，其张成空间即为原空间的正交补。
- **应用：线性基求交**：
  - 多个集合均能表示某值 $ x $，等价于 $ x $ 属于它们的线性基交集。
  - 利用正交性：$ x $ 在交集中 $ \iff $ $ x $ 与所有正交线性基的并集正交。
  - 方法：将各集合的正交线性基合并，求其线性基，再求其正交补，即为原线性基的交。

#### **5. 带删线性基（原创贡献）**
- **挑战**：传统线性基不支持删除，且前缀线性基难以在线处理任意修改。
- **核心思想**：维护额外信息 `resp` 和 `wresp`，分别表示原元素和基元素如何由原始元素子集异或得到（状压表示）。

##### **(1) 部分前缀性带删线性基（5.1节）**
- 维护标准基（实际参与构成线性基的原始元素）。
- 插入/删除时，利用 `wresp` 还原元素的组成，动态调整标准基。
- 支持在线操作，但 `w` 数组不具前缀性，仅能维护扩张信息。
- 时间复杂度：$ O((n + m)^2 / w) $，受限于长二进制数运算。

##### **(2) 完全前缀性带删线性基（5.3节）**
- 强制规定线性基形态必须与按编号顺序插入的结果一致。
- 删除操作视为“撤销最后一次插入”，通过 `p` 位标识和逆向推理还原每一步操作。
- 利用 `cresp`, `wresp` 中是否包含被删元素位作为线索，逆向执行交换与异或操作。
- 实现复杂但功能强大，支持真正的前缀查询与任意修改。
- 时间复杂度：$ O(n^2 / w) $ 每次修改。

##### **(3) 结合线段树优化区间查询（5.2节）**
- 将带删线性基应用于线段树节点，每个节点维护其区间的标准基。
- 修改时影响沿树上传，每次只引发 $ O(1) $ 次插入/删除事件。
- 查询时合并左右子区间的标准基（最多 $ O(m) $ 个元素），总复杂度 $ O(m^2) $。
- 最终复杂度：$ O(nm + qm(\log n + m)) $，优于传统线段树合并线性基的 $ O(q m^2 \log n) $。