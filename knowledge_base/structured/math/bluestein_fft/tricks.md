# 不一般的DFT

**Author:** 周雨扬

### 关键思想与技巧

#### 1. **Bluestein算法核心推导**
- 标准DFT定义为：
  $$
  V(j) = \sum_{i=0}^{n-1} a_i \omega_n^{ij}
  $$
- 利用恒等式：
  $$
  ij = \binom{i+j}{2} - \binom{i}{2} - \binom{j}{2}
  $$
  可得：
  $$
  \omega_n^{ij} = \omega_n^{\binom{i+j}{2}} \cdot \omega_n^{-\binom{i}{2}} \cdot \omega_n^{-\binom{j}{2}}
  $$
- 代入原式：
  $$
  V(j) = \omega_n^{\binom{j}{2}} \sum_{i=0}^{n-1} a_i \omega_n^{-\binom{i}{2}} \cdot \omega_n^{\binom{i+j}{2}}
  $$
- 设：
  $$
  B(i) = a_i \omega_n^{-\binom{i}{2}},\quad C(k) = \omega_n^{\binom{k}{2}}
  $$
  则：
  $$
  V(j) \omega_n^{-\binom{j}{2}} = \sum_{i=0}^{n-1} B(i) \cdot C(j + i)
  $$
  即为一个**减法卷积**（实际上是标准卷积的反转）。

#### 2. **卷积实现优化**
- 上述卷积可通过补零至长度 $2n$ 后使用MTT或NTT完成，避免3倍长度开销。
- 因只关心中间 $n$ 项结果，且FFT本质是循环卷积，只要保证非零部分不混叠即可正确还原线性卷积。

#### 3. **IDFT的类似处理**
- IDFT公式为：
  $$
  a_j = \frac{1}{n} \sum_{k=0}^{n-1} V(k) \omega_n^{-jk}
  $$
- 类似地使用：
  $$
  -jk = \binom{j+k}{2} - \binom{j}{2} - \binom{k}{2}
  $$
  可将IDFT也转化为卷积形式，同样适用Bluestein算法。

#### 4. **模意义下的扩展应用**
- 当模数 $p$ 存在原根 $g$ 时，集合 $\{ g^0, g^1, ..., g^{p-2} \}$ 构成模 $p$ 下 $[1, p-1]$ 的完全剩余系。
- 因此对多项式做模长为 $p-1$ 的DFT，即可一次性求出所有 $x=1,2,...,p-1$ 处的点值。
- 对于 $x=0$，直接取常数项；对于与模数不互质的情况（如 $p = q^c$），只需暴力计算低次项贡献（最多前 $c$ 项），因 $c = O(\log p)$，整体仍为 $O(p \log p)$。

#### 5. **多项式多点求值的应用**
- 若查询点满足几何序列或仿射递推（如 $q_i = a q_{i-1} + b$），可通过变量替换将其转化为 $a^i$ 形式。
- 然后利用Bluestein算法计算 $f(a^i)$，即形如 $\sum_j f_j a^{ij}$ 的表达式，正好匹配DFT结构。

#### 6. **多项式多点插值的应用**
- 拉格朗日插值可转化为：
  $$
  f(x) = \sum_i \frac{g_i}{x - a_i} \cdot \frac{F(x)}{F'(a_i)},\quad F(x) = \prod (x - a_i)
  $$
- 其中 $\sum_i \frac{v_i}{x - a_i}$ 展开为幂级数后系数为 $\sum_i v_i a_i^{-(j+1)}$。
- 若 $a_i$ 是单位根的幂（如模 $p$ 原根生成），则可用Bluestein加速该求和过程。

#### 7. **特殊情况处理**
- **当 $a_i = 0$ 时**：不能直接使用上述展开，解决方案包括：
  - 整体平移 $x \to x + k$ 避开0；
  - 使用“部分拉格朗日插值”，先忽略 $a_i=0$ 插值得到基础多项式，再调整使其满足 $f(0)=g_0$。
- **模数为 $2^c$ 时无原根**：但可用 $\pm 3^k$ 构造满射，配合两次DFT处理正负部分。

#### 8. **Vandermonde方程组求解**
- 给定 $G(j) = \sum_i v_i x_i^j$，若 $x_i$ 落在单位根群中，则可通过映射到频域转为IDFT问题，从而在 $O(p \log p)$ 内求解。