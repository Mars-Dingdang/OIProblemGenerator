# 浅谈一类树上范围相关问题

**Author:** 朱屹帆

### 关键思想与技巧

1. **核心观察：利用Dirichlet卷积**
   - 算法的核心是寻找一个合适的积性函数 `g`，使得其与目标函数 `f` 的Dirichlet卷积 `h = f * g` 具有易于计算前缀和的性质。
   - 例如，对于莫比乌斯函数 `μ`，有 `μ * I = ε`，其中 `I` 是常数函数1，`ε` 是单位函数。这允许我们用已知的 `S_I` 和 `S_ε` 来递归地求解 `S_μ`。

2. **递归公式推导**
   - 利用卷积的定义 `h(n) = Σ_{d|n} f(d)g(n/d)`，可以推导出前缀和的恒等式：
     `S_h(n) = Σ_{k=1}^n h(k) = Σ_{k=1}^n Σ_{d|k} f(d)g(k/d) = Σ_{d=1}^n f(d) S_g(⌊n/d⌋)`
   - 将上式变形，得到关键的递归关系：
     `S_f(n) = (S_h(n) - Σ_{k=2}^n g(k) S_f(⌊n/k⌋)) / g(1)`
   - 这个公式表明，要求解 `S_f(n)`，只需要知道 `S_h(n)`、`g(k)` 以及所有 `S_f(⌊n/k⌋)` 的值。

3. **整除分块与记忆化搜索**
   - 观察到 `⌊n/k⌋` 的取值只有 `O(√n)` 种。因此，需要计算的 `S_f(m)` 的 `m` 值也仅有 `O(√n)` 个。
   - 使用哈希表或数组对这些 `S_f(⌊n/k⌋)` 的结果进行记忆化存储，避免重复计算。

4. **时间复杂度分析**
   - **基础版本 (O(n^{2/3}))**: 
     - 对于 `m ≤ n^{2/3}` 的 `S_f(m)`，直接预处理出来，时间复杂度为 `O(n^{2/3})`。
     - 对于 `m > n^{2/3}` 的 `S_f(m)`，使用上述递归公式计算。此时 `k` 的范围是 `1` 到 `n/m < n^{1/3}`，所以总复杂度为 `Σ_{k=1}^{n^{1/3}} O(√(n/k)) ≈ O(n^{2/3})`。
   - **优化版本 (O(√n poly log n))**: 
     - 论文引入了更高级的数学工具，如幂级数（Power Series）、指数生成函数（H[S]）和对数生成函数（OQ），来处理一类特殊的积性函数（如 `f(p)=p(p-1)`）。
     - 通过将问题转化为在特定多项式环上的运算，并结合精细的分块策略（如按 `⌈S log x⌉` 分组），最终将复杂度降至 `O(√n log²n / √log log n)`。

5. **应用范围**
   - 该算法特别适用于那些无法通过简单筛法（如埃氏筛、欧拉筛）在线性时间内解决的积性函数前缀和问题，例如莫比乌斯函数 `μ`、欧拉函数 `φ` 等的前缀和。