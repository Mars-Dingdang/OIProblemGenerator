## 关键观察与技巧

### 1. 内积（点积）
- **几何意义**：投影长度与模的乘积，可用于计算夹角、垂直判定。
- **代数计算**：分量乘积之和，避免三角函数开销。
- **垂直判定**：`a·b = 0` 等价于两向量垂直（包括零向量）。
- **共线判定**：`|a·b| = |a||b|` 等价于两向量共线。

### 2. 外积（叉积，仅三维）
- **几何意义**：结果向量垂直于原向量平面，模等于平行四边形面积。
- **方向**：遵循右手法则，可用于判定旋转方向（顺负逆正）。
- **共线判定**：`a×b = 0` 等价于两向量共线（包括零向量）。
- **面积计算**：`|a×b|` 为平行四边形面积，三角形面积为其一半。

### 3. 二维叉积（伪标量）
- 将二维向量视为 `(x, y, 0)`，叉积结果只有 z 分量有意义。
- `cross2d(a, b) = a.x*b.y - a.y*b.x`：
  - **绝对值**：平行四边形面积。
  - **符号**：表示 `b` 相对于 `a` 的旋转方向（正为逆时针）。

### 4. 混合积（三重积）
- `[a b c] = a·(b×c) = det(a, b, c)`
- **几何意义**：绝对值等于平行六面体体积。
- **应用**：
  - **体积计算**：四面体体积为 `|det(AB, AC, AD)|/6`。
  - **共面判定**：`det(a, b, c) = 0` 表示三向量共面。
  - **手性判定**：符号表示右手系（正）或左手系（负）。

### 5. 旋转矩阵（罗德里格斯公式）
- 绕单位轴 `u` 旋转角度 `θ` 的矩阵可直接套用公式，避免四元数转换。
- 若轴不过原点，先平移坐标系。

### 6. 仿射变换
- 平移不是线性变换，但可通过齐次坐标（增加一维）表示为线性变换。
- 通用方法：将 `n` 维向量扩展为 `(x1, ..., xn, 1)`，变换矩阵增加一行一列。

### 7. 优化技巧
- **避免重复计算**：如多次使用模长时先计算并存储。
- **精度处理**：比较浮点数时使用容差 `eps`（如 `1e-9`）。
- **整数向量**：当坐标均为整数时，叉积、点积结果也为整数，可精确判断。

### 8. 常见问题转化
- **多边形面积**：利用叉积（有向面积）求和，取绝对值。
- **点在线段投影**：利用点积计算参数 `t`，截断到 `[0,1]`。
- **线段相交判定**：通过叉积符号判断跨立，结合快速排斥实验。
- **三维凸包**：基于混合积符号判断面的可见性。

### 9. 注意事项
- 外积仅定义在三维空间，二维需用伪叉积。
- 零向量与任何向量既垂直又共线（根据定义）。
- 旋转矩阵公式要求旋转轴为单位向量，使用时需归一化。