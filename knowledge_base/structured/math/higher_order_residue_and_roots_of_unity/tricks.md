## 关键观察与技巧

### 1. 问题转化
- **互素情形**：当 `gcd(a, m) = 1` 时，利用原根将方程 `x^k ≡ a (mod m)` 转化为线性同余方程 `k*y ≡ ind_g(a) (mod φ(m))`。
- **非互素情形**：通过中国剩余定理分解为素数幂模，再分别处理。
- **偶数 k 模 2^e**：需额外判断 `a ≡ 1 (mod 4)` 且 `a^{d'} ≡ 1 (mod m)`，其中 `d' = 2^{e-2}/gcd(k, 2^{e-2})`。

### 2. 单位根的应用
- **生成所有解**：若已知一个特解 `x0`，则所有解为 `x0 * r`，其中 `r` 遍历模 `m` 的 `k` 次单位根。
- **加速计算**：当需要多次计算 `k` 次方根时，可预处理单位根集合。
- **NTT 模数**：寻找 `2^e` 次本原单位根用于数论变换，要求模数 `m` 的每个素因子形如 `c*2^e + 1`。

### 3. 复杂度优化
- **朴素算法**：`O(√m)` 来自 BSGS 求离散对数。
- **改良 Tonelli–Shanks**：
  - 将 `k` 分解为素数幂 `p^e`，依次开方。
  - 对每个 `p^e`，在 `p` 次单位根群中用 BSGS 逐位计算离散对数，复杂度 `O(√(s-e)*p)`，其中 `s = ν_p(φ(m))`。
  - 总复杂度 `O(m^{1/4+ε})`，优于朴素算法。
- **避免大素数因子**：只对 `≤ m^{1/4}` 的素因子进行分解和计算，大因子至多一个且指数小于 4，可单独处理。

### 4. 判定无解的快速方法
- **奇素数幂模**：`a` 是 `k` 次剩余当且仅当 `a^{φ(m)/d} ≡ 1 (mod m)`，其中 `d = gcd(k, φ(m))`。
- **2^e 模，k 偶数**：需同时满足 `a ≡ 1 (mod 4)` 和 `a^{d'} ≡ 1 (mod m)`。
- 这些判定可在 `O(log m)` 内完成，避免直接求解。

### 5. 随机化技巧
- **寻找原根**：随机选取并测试，期望次数很小。
- **寻找 p 次非剩余**：随机选取 `η` 并验证 `η^{φ(m)/p} ≠ 1`，期望 4 次内找到。
- **λ-原根**：用于生成任意 `k` 次本原单位根，密度足够高。

### 6. 实现细节
- **模 2^e 的特殊表示**：奇数 `a` 可唯一表示为 `(-1)^s * 5^r mod 2^e`，其中 `s ∈ {0,1}`，`r ∈ [0, 2^{e-2})`。
- **线性同余方程求解**：使用扩展欧几里得，注意解的存在性和通解形式。
- **Pollard Rho**：用于分解 `d`，可在 `O(m^{1/4})` 内完成。

### 7. 常见问题模式
- **求所有解**：先求一个特解，再乘上所有单位根。
- **判断解的存在性**：使用上述判定条件。
- **求最小解**：在通解中取最小非负剩余。
- **模数非素数**：用中国剩余定理分解，注意各分量解的存在性需同时满足。