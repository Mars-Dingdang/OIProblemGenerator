- **核心思想**：当只能高效实现区间扩展（如添加元素）而难以撤销（如删除后更新答案）时，采用“回滚”机制避免不可逆操作。
- **分块排序**：按左端点所在块第一关键字、右端点第二关键字排序，保证右端点在同块内单调递增，减少移动次数。
- **同块暴力处理**：若询问区间完全位于同一块内，直接暴力扫描计算，时间复杂度为 $ O(\text{block size}) $。
- **初始化与回滚**：每当进入新块时，重置莫队区间并清空计数；处理跨块询问时，先扩展右端点，再临时扩展左端点，记录状态后立即回滚左端点修改，保持主结构不变。
- **仅使用单一操作**：整个算法只使用 `Add` 操作，删除通过回滚代替，适用于最大值类无法快速合并的问题（如本例中的重要度最大值）。
- **离散化预处理**：对原数组值域进行离散化，便于统计频次和索引映射。
- **复杂度优化**：取块大小为 $ \frac{n}{\sqrt{m}} $ 可使总复杂度达到最优 $ O(n\sqrt{m}) $。