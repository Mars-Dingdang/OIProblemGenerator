- **中位数划分技巧**：建树时使用当前层排序后的中位数作为分界，保证左右子树大小平衡。
- **前缀计数优化**：`toleft[deep][i]` 记录从区间左端点到 `i` 有多少个元素被划分到左子树，便于快速定位下一层的查询区间。
- **相同值处理策略**：通过 `same` 变量控制等于中位数的元素分配，确保左子树恰好有 `(right-left+1)/2` 个元素。
- **与归并排序类比**：划分树的结构类似于归并排序过程，可用于统计逆序对——每个右节点在左节点之前即构成逆序对。
- **动态维护逆序对**：在处理“动态逆序对”问题时，可结合树状数组按层数组块进行修改和查询，利用 `lowbit(x) < (1 << level)` 来限制更新范围不跨块。
- **块内树状数组设计**：对于每层大小为 $2^k$ 的块，使用位移 `(x-1) >> k` 确定所属块，向下跳时判断是否越界，实现精确的局部更新。
- **常数优势**：相比主席树，划分树建树和查询逻辑更简单，常数更小，在实际测试中性能优于主席树（如文中 889ms vs 1482ms）。