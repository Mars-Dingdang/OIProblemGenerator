- **轻边跳跃性质**：每次经过一条轻边，子树大小至少减半，因此任意路径最多经过 $O(\log n)$ 条重链。
- **DFS 序连续性**：每条重链上的节点 DFS 序连续，便于用线段树等数据结构维护。
- **路径跳转技巧**：在处理路径时，每次跳到当前所在链的顶端的父亲，直到两点位于同一条链上。
- **换根操作处理**：通过分类讨论当前根与查询点的关系，将换根后的子树操作映射回原始 DFS 序区间。特别地，当查询点是当前根或其祖先时，需找到对应“排除子树”的边界点 $v$，利用 `rnk[dfn[top[v]] + dep[u] + 1 - dep[top[v]]]` 高效计算。
- **LCA 优化**：使用重链剖分可在 $O(\log n)$ 时间内求 LCA，常数小于倍增法，在某些题目中更具优势。
- **合并查询逻辑**：在路径查询中，可统一处理跳链过程中的区间合并，避免重复代码。
- **初始化注意**：确保 `son[u]` 初始为 0 或 -1，防止未定义行为；`dep[0] = 0` 可简化边界判断。