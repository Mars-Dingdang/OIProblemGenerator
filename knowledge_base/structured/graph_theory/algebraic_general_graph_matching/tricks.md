# 基于线性代数的一般图匹配

**Author:** 杨家齐

### 关键思想与技巧

- **Tutte 矩阵与完美匹配**：
  - Tutte 矩阵是一个斜对称矩阵，每条边 $(i,j)$ 对应变量 $x_{i,j}$，且 $A_{i,j} = x_{i,j}, A_{j,i} = -x_{i,j}$。
  - 图有完美匹配当且仅当 $\det \tilde{A}(G) \not\equiv 0$（Tutte 定理）。
  - 行列式展开中，奇环覆盖项成对抵消（反向后符号相同但边变号导致整体符号相反），仅偶环覆盖（即完美匹配对应的二元环）贡献非零项。

- **随机化判定（Lovász 测试）**：
  - 直接符号计算行列式不可行（指数复杂度）。
  - 使用 **Schwartz-Zippel 引理**：若多项式不恒为零，则在足够大的有限域上随机赋值后结果为零的概率 ≤ $d / |F|$，其中 $d$ 是次数（此处为 $O(n)$）。
  - 实践中选取大质数 $p \sim n^2$，在 $\mathbb{F}_p$ 上随机赋值变量，计算数值行列式。错误率 $O(1/n)$，可重复降低。

- **构造匹配方案优化**：
  - 暴力枚举边删除需 $O(n^2)$ 次行列式计算，总复杂度 $O(n^{\omega+2})$。
  - **Rabin-Vazirani 定理**：若 $\tilde{A}$ 可逆，则 $(\tilde{A}^{-1})_{i,j} \neq 0$ 当且仅当边 $(v_i,v_j)$ 属于某个完美匹配（等价于 $G-\{v_i,v_j\}$ 有完美匹配）。
  - 因此只需一次求逆，之后扫描逆矩阵即可找到可匹配边。

- **斜对称矩阵性质**：
  - 奇数阶斜对称矩阵行列式为 0。
  - 斜对称矩阵的秩必为偶数（由极大线性无关组构成的主子式仍斜对称且满秩，故阶数为偶）。
  - 这保证了最大匹配大小 $\nu(G) = \frac{1}{2} \mathrm{rank}\, \tilde{A}(G)$ 的合理性。

- **高效维护逆矩阵（高斯消元法）**：
  - 每次删除两个点相当于从矩阵中删去两行两列。
  - 利用 **分块矩阵求逆公式**（Theorem 3.11）：若已知 $A^{-1}$，删去第一行一列后的子矩阵 $B$ 的逆可通过 $\hat{B} - \hat{u}\hat{v}^T / \hat{a}_{1,1}$ 得到，这恰好是高斯消元一步的结果。
  - 因此可在 $O(n^2)$ 时间内更新逆矩阵，共 $O(n)$ 步，总复杂度降至 $O(n^3)$。

- **最大匹配转化**：
  - 最大匹配大小直接由 $\mathrm{rank}\, \tilde{A}(G)/2$ 给出。
  - 构造最大匹配时，可先通过高斯消元找出一组行极大线性无关组对应点集 $U$，则 $G[U]$ 有完美匹配，对其运行完美匹配算法即可。

- **应用优势**：
  - 易于判断某点或某边是否**一定属于**某个最大匹配：通过添加辅助点构造新图，检查逆矩阵对应位置是否为零。
  - 解决 **Undirected Vertex Geography (UVG)** 游戏：起点必胜当且仅当该点不一定在所有最大匹配中（即存在最大匹配不含它）。
  - **最大权匹配**：将边权作为变量 $y$ 的指数（$A_{i,j} := A_{i,j} \cdot y^{w_{i,j}}$），求行列式关于 $y$ 的最高次项（通过插值法），其次数除以 2 即为最大权。