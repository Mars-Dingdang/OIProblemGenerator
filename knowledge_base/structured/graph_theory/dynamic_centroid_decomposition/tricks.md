- **点分树（Centroid Tree）**: 每次选取重心作为分治中心，保证深度为 $O(\log n)$，总复杂度 $O(n \log n)$。
- **避免重复计算**: 对每个连通块维护两个信息：到当前分治中心的距离和到父分治中心的距离，用以容斥修正重复部分。
- **数据结构嵌套**: 使用可删堆（`priority_queue` 差分实现）或动态开点线段树维护动态集合的聚合信息（如最大值、区间和）。
- **祖先跳转修改**: 修改操作沿点分树上的祖先链向上跳，利用深度限制在 $O(\log n)$ 步完成更新。
- **距离预处理**: 预处理原树上任意两点间距离（通过 LCA），并存储每个点到其各层祖先的距离，便于快速查询。
- **双遍 `calcsiz` 技巧**: 第一遍找重心，第二遍以重心为根重新计算子树大小，确保后续 DFS 正确性。
- **注意不可累加性**: 点到其点分树祖先的距离不是单调递增的，必须单独计算而非累加边权。