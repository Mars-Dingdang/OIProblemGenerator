## Key Observations

1. **轮廓线DP思想**：逐格DP，轮廓线分隔已决策和未决策区域。轮廓线包含m个上插头和1个左插头，宽度为m+1。

2. **状态编码**：
   - **最小表示法**：将连通分量映射为最小整数，保证相同状态编码一致。
   - **括号表示法**：用左右括号表示插头配对，适合回路问题。

3. **状态转移分类**：
   - **合并插头**：当左、上都有插头且属于不同连通块时合并。
   - **延续插头**：当只有一个插头时，向下或向右延伸。
   - **创建插头**：当没有插头时，创建一对新插头（需满足棋盘边界条件）。

4. **哈希优化**：合法状态通常稀疏，使用哈希表（手写或unordered_map）存储DP状态，大幅节省空间。

## Common Optimizations

1. **滚动数组**：使用两个哈希表H0和H1交替表示当前和下一状态。
2. **状态压缩**：将插头状态数组编码为整数，便于哈希存储。
3. **预处理合法状态**：对于固定m，可预处理所有合法括号序列状态，减少运行时编码开销。
4. **对称性剪枝**：当n>m时交换行列，减少状态数。

## Problem Transformation Patterns

1. **回路问题→路径问题**：固定起点终点，转化为回路问题（如Betsy's Tours）。
2. **权值最大化**：在状态转移时累加格子权值，求最大权值和（如神奇游乐园）。
3. **障碍处理**：障碍格子不允许插头通过，状态转移时跳过。
4. **独立插头处理**：路径问题中，允许未匹配的插头（独立插头）出现不超过2次，记录事件次数。

## Implementation Tips

1. **encode/decode函数**：封装状态编码解码，确保正确性。
2. **push函数**：统一处理状态转移和哈希插入。
3. **roll操作**：一行结束后左移状态，补足下一行左插头。
4. **边界判断**：仔细处理棋盘边界，防止插头伸出棋盘外。