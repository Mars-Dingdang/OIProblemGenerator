# 浅谈决策单调性动态规划的线性解法

**Author:** 冯哲

### 关键思想与技巧

- **决策单调性**：若权函数 $ w_{i,j} $ 满足四边形不等式 $ w_{a,c} + w_{b,d} \leq w_{a,d} + w_{b,c} $ 对所有 $ a \leq b \leq c \leq d $ 成立，则对应的DP问题具有决策单调性，即最优决策点 $ k_j $ 随 $ j $ 单调不降。

- **SMAWK算法核心思想**：
  - 利用矩阵的**完全单调性**（completely monotone matrix），即每列的最小值位置在行上单调不降，且任意子矩阵也满足此性质。
  - **Reduce操作**：通过扫描和比较相邻列的候选行，删除无用行。关键引理：若在列 $ j $ 上，行 $ i_1 < i_2 $ 且 $ A[i_1][j] > A[i_2][j] $，则对所有 $ c \leq j $，$ A[i_2][c] $ 不可能是第 $ c $ 列的最小值；反之若 $ A[i_1][j] \leq A[i_2][j] $，则对所有 $ c \geq j $，$ A[i_1][c] $ 无用。
  - Reduce可在 $ O(M) $ 时间将 $ M \times N $ 矩阵（$ M > N $）压缩为 $ N \times N $ 的完全单调子矩阵。
  - 递归处理奇数列，再利用决策单调性插值偶数列，总复杂度 $ T(N) = T(N/2) + O(N) = O(N) $。

- **线性DP实现技巧**：
  - 维护两个指针 $ r $ 和 $ c $，表示前 $ c $ 个状态已计算，且前 $ r $ 行的贡献已知。
  - 构造一个临时矩阵包含已知决策行和待计算区间的部分值，使用类似SMAWK的方法批量求出中间最小值 $ G $。
  - 利用 $ G[j] $ 和 $ A_{j-1,j} $ 比较来更新当前状态，并根据比较结果决定是否跳过某些决策或更新缓存 $ E $（记录非当前行区间的最优值）。
  - 每次操作扩展 $ \Theta(c - r) $ 个新状态，而 $ r $ 或 $ c $ 至少前进 $ \Omega(c - r) $，因此总摊还代价为 $ O(N) $。

- **避免重复查询**：传统单调队列+二分需 $ O(N \log N) $ 次 $ w_{i,j} $ 查询，而本方法通过批量处理和矩阵性质减少冗余计算，使查询次数更稳定且接近线性。

- **适用条件**：要求 $ w_{i,j} $ 可快速计算（如 $ O(1) $），且满足四边形不等式。适用于无法转化为斜率优化形式的一般决策单调DP。