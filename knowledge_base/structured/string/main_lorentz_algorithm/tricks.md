## Key Observations
- **分治思想**：将字符串分为左右两半，分别处理完全在左/右的重串，再处理跨越中点的交叉重串。
- **交叉重串分类**：根据中间字符的位置分为左偏（middle in left half）和右偏（middle in right half）。
- **Z函数加速**：利用Z函数在O(1)时间内计算k1和k2，即前后缀匹配的最大长度。
- **四元组表示**：每个重串可压缩为(cntr, l, k1, k2)，其中cntr是参考位置，l是原串长度的一半，k1/k2是前后匹配长度。

## Optimizations
- **避免重复枚举**：通过固定cntr，将可能的l1和l2范围限制在k1和k2内，只枚举有效的组合。
- **对称处理**：左偏和右偏的计算方法对称，只需调整Z函数的输入字符串顺序。
- **递归压缩**：递归处理子串，总复杂度由主定理保证为O(n log n)。

## Problem Transformation Patterns
- **寻找最长重串**：算法可直接用于寻找最长重串，只需在convert_to_repetitions中记录最大长度。
- **计数重串**：可通过四元组统计数量而不展开具体位置，保持O(n log n)复杂度。
- **处理循环节**：重串的循环节长度p可由l推导，重复次数r至少为2。
- **本原重串过滤**：若需只输出本原重串（原串不是重串），可在输出前检查原串是否可再分解。