## 关键观察与技巧

### 1. 哈希公式选择
- **常用定义**：`H(s) = s[0]*b^(n-1) + s[1]*b^(n-2) + ... + s[n-1]`（类比b进制数）
- **子串哈希计算**：`H(s[l..r]) = H(r) - H(l-1) * b^(r-l+1)`
- **注意**：另一种定义 `H(s) = s[0] + s[1]*b + ... + s[n-1]*b^(n-1)` 会导致不同的子串计算公式

### 2. 参数选择
- **基数b**：常用质数 131, 13331, 233 等
- **模数M**：
  - 自然溢出：使用 `unsigned long long`，模 2^64，速度快但可能被卡
  - 大质数：1e9+7, 1e9+9, 998244353 等
  - 双哈希：两个不同模数组合，安全性更高

### 3. 防卡技巧
- **自然溢出被卡**：
  - 当b为偶数时，构造长度≥64的字符串如 `aaa...a` 与 `baa...a`
  - 当b为奇数时，通过递归构造 `s_i = s_{i-1} + !s_{i-1}`（!表示字符反转）
- **大模数被卡**：随机生成大量短字符串（如10^6个长度6的62字符集字符串）有高碰撞概率
- **解决方案**：使用双哈希或多哈希

### 4. 常见应用模式
- **快速比较子串**：预处理后O(1)比较任意两个子串是否相等
- **字符串匹配**：计算模式串哈希，滑动窗口比较
- **允许k次失配**：哈希+二分找第一个不同位置，重复k次
- **最长回文子串**：
  - 二分答案+哈希检查：O(n log n)
  - 优化：利用 `R[i] ≤ R[i-1] + 2` 性质，O(n)解决
- **最长公共子串**：二分长度，对所有字符串的长度k子串哈希求交集
- **不同子串计数**：枚举所有长度，计算哈希去重
- **字符串拼接去重**：如CF1200E，求最长公共前后缀哈希比较

### 5. 实现细节
- **预处理幂次**：提前计算 `pow[i] = b^i`，避免快速幂开销
- **负数处理**：取模时 `(a - b + mod) % mod` 防止负数
- **双哈希比较**：两个哈希值都相等才认为字符串相等
- **字符映射**：通常直接用ASCII值，也可映射到1-26（小写字母）

### 6. 与其它算法对比
- **vs KMP**：哈希更灵活，支持快速子串比较，但可能有碰撞风险
- **vs 后缀数组**：哈希实现简单，但功能有限（不能处理后缀排序等）
- **vs Trie**：哈希适合一次性比较，Trie适合前缀查询

### 7. 注意事项
- **哈希冲突**：虽然概率低，但在比赛中可能被特意构造数据卡掉
- **模数选择**：避免使用常见模数的倍数
- **时间复杂度**：预处理O(n)，查询O(1)，但双哈希有常数开销
- **空间复杂度**：O(n)存储前缀哈希和幂次表